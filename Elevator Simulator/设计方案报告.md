# 设计方案报告

本文档旨在对本程序的设计思路和实现方法进行简明的介绍，以证明代码完全自己手写，并阐述程序中体现出的调度算法和多线程编程方法的使用。

项目地址:  [Elevator Simulator](https://github.com/ludanxer/OperatingSystemAssignments/tree/master/Elevator%20Simulator)

## 类的设计：

1. 类`Elevator`：用来表示电梯的类。
   * 列表`to_floor_list`：用来表示该电梯的任务列表，即该电梯要去的楼层
   * 属性`current_floot`：用来表示电梯当前所在楼层
   * 属性`status`：用来表示电梯当前的状态 0-空闲，1-上行，2-下行，3-上行等待，4-下行等待。（上行等待，即用户在某层按下上行键，电梯到达并开门后，用户进入电梯，电梯等待用户按下要去的楼层的状态）
2. 类`Bubble`：用来表示气泡（气泡的定义见使用说明）。
   * 列表`button_list`：用来表示每个气泡中的20个楼层按钮
   * 列表`pressed_button_list`：用来表示用户按下的电梯按钮们
   * 方法`initUI`：创建每个气泡中的20的楼层按钮
3. 类`BubbleButton`：用来表示气泡中的1-20楼层按钮
   * 属性`clickable`：用来表示气泡中哪些按钮可以按下（如用户在6层按下上行键，电梯到达后，1-5层的按钮应该是无法按下的）
4. 类`Communication`：用来接收电梯移动的信号，并触发电梯移动的动画
5. 类`UpDownButton`：用来表示界面右侧的上、下行按钮
   * 属性`up_down`：表示该按钮是上，还是下。 1-上，2-下。
   * 属性`floor_num`：表示该按钮所在楼层
6. 类`ElevatorSimulator`：主要模拟电梯的类
   * `up_list`,`down_list`：用来储存暂时无法处理的上、下行按键
   * `elevator_list`，`bubble_lsit`：用来储存所有的电梯和气泡控件
   * `elevator_animation_list`，`bubble_animation_list`：用来储存电梯和气泡的动画实例

## 主要方法：

1. 方法`load_qss`：加载qss文件，即类似css的`Qt Style Sheet`文件，给程序中的各个控件添加颜色、样式，美化界面
2. 方法`paintEvent`, `draw_line`：描绘界面中的五条虚线，模拟电梯绳，美化界面
3. 方法`create_elevator`, `create_bubble`, `create_up_down_button`：创建电梯、气泡和上、下行按钮控件
4. 方法`up_down_pressed`：上、下行按钮按下后触发的函数
5. 方法`ele_animation_finished`, `down_finished`：分别为电梯运动动画一次结束后，气泡向下动画结束后所触发的函数
6. `bubble_animation`, `bubble_down`：气泡向上、向下运动动画的调用函数

## 调度算法：

每当上、下行按钮按下时，判断所有五个电梯的状态（此时上行等待、下行等待分别归为上、下行状态）：

1. 五个电梯都处于空闲状态，直接调用离当前楼层最近的电梯
2. 处于空闲或上、下行状态，首先判断是否有电梯即将经过这个楼层，如果有，接上这个楼层的用户，否则调用空闲的离的最近的电梯
3. 如果都处于上、下行状态，首先判断是否有电梯即将经过这个楼层，如果有，接上这个楼层的用户，否则将楼层放入等待列表。
4. 每当电梯的状态发生变化时，即从上行变为空闲或下行时，该电梯将按以上三条原则按顺序处理等待列表中的按键，直至等待列表为空。

## 多线程编程思想：

1. 五个电梯运动互不影响
2. 五个电梯运动和气泡的出现互不影响
3. 电梯运动时并不影响任何按键按下等

